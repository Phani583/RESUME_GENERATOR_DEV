{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Resume Builder — Auth</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />

    <style>
      :root {
        --page-bg: #f6efe6;
        --card-bg: #ffffff;
        --muted: #8f7f73;
        --accent: #d58856;
        --accent-dark: #bf6f39;
        --radius: 14px;
        --shadow: 0 22px 40px rgba(17, 15, 12, 0.07);
        --inner-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.03);
        --input-fill: #f2ece6;
        font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto,
          Arial;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(180deg, var(--page-bg), #fff 60%);
        color: #2b1a12;
        padding: 28px;
      }

      /* MAIN CONTAINER */
      .container {
        width: 520px;
        max-width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 14px;
      }

      /* HEADER AREA */
      .top-badge {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .badge {
        width: 62px;
        height: 62px;
        border-radius: 14px;
        background: linear-gradient(135deg, var(--accent), var(--accent-dark));
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
        font-size: 22px;
        color: white;
        box-shadow: 0 12px 28px rgba(189, 112, 67, 0.18);
      }

      .brand-title {
        font-size: 20px;
        font-weight: 800;
        margin-top: 6px;
      }

      /* HERO TEXT */
      .hero {
        text-align: center;
        margin-top: 4px;
      }

      .hero h1 {
        font-size: 38px;
        font-weight: 800;
        margin: 0;
      }

      .hero p {
        margin-top: 6px;
        color: var(--muted);
        font-size: 14px;
      }

      /* CARD */
      .card {
        width: 520px;
        max-width: 100%;
        background: var(--card-bg);
        border-radius: 16px;
        padding: 20px;
        box-shadow: var(--shadow);
        overflow: hidden;
      }

      /* PANEL SLIDE */
      .panel-viewport {
        width: 100%;
        overflow: hidden;
      }

      .panel-track {
        display: flex;
        width: 200%;
        transition: transform 420ms cubic-bezier(0.2, 0.9, 0.3, 1);
      }

      .card.registered .panel-track {
        transform: translateX(-50%);
      }

      /* PANELS */
      .panel {
        width: 50%;
        padding: 14px;
        min-height: 320px;
      }

      /* FORM ELEMENTS */
      label {
        font-size: 13px;
        font-weight: 600;
        margin-bottom: 4px;
        display: block;
      }

      .input-wrap {
        display: flex;
        align-items: center;
        gap: 10px;
        background: var(--input-fill);
        border: 1px solid rgba(0, 0, 0, 0.06);
        border-radius: 10px;
        padding: 12px;
      }

      .input-wrap input {
        border: none;
        background: transparent;
        flex: 1;
        padding: 6px 4px;
        font-size: 15px;
        outline: none;
      }

      .icon {
        font-size: 18px;
        color: var(--muted);
      }

      .forgot-row {
        margin-top: 8px;
        display: flex;
        justify-content: space-between;
        font-size: 14px;
      }

      /* BUTTONS */
      .btn {
        width: 100%;
        padding: 13px 16px;
        font-size: 16px;
        font-weight: 700;
        background: var(--accent);
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        box-shadow: 0 10px 26px rgba(189, 112, 67, 0.18);
      }

      .btn.ghost {
        background: transparent;
        color: var(--accent-dark);
        border: 1px solid rgba(50, 30, 17, 0.12);
        box-shadow: none;
      }

      .btn:hover {
        transform: translateY(-2px);
      }

      /* DIVIDER */
      .divider {
        margin-top: 12px;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .divider span {
        color: var(--muted);
        font-size: 12px;
      }

      .divider:before,
      .divider:after {
        content: "";
        flex: 1;
        height: 1px;
        background: rgba(0, 0, 0, 0.06);
      }

      .socials {
        display: flex;
        gap: 10px;
        margin-top: 8px;
      }

      .social {
        flex: 1;
        padding: 10px;
        background: #fbf6f2;
        border-radius: 10px;
        text-align: center;
        font-weight: 700;
        border: 1px solid rgba(0, 0, 0, 0.05);
        color: #2b1a12;
      }

      /* FOOTER */
      .card-footer {
        margin-top: 10px;
        text-align: center;
        font-size: 14px;
        color: var(--muted);
      }

      .card-footer a {
        color: var(--accent);
        font-weight: 700;
        cursor: pointer;
      }

      /* PWD TOGGLE */
      .pwd-toggle {
        background: transparent;
        border: none;
        cursor: pointer;
        font-size: 18px;
        color: var(--muted);
      }

      .messages {
        margin-bottom: 10px;
      }

      .messages .error {
        background: #ffe5e5;
        color: #b10000;
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 6px;
        font-size: 14px;
      }

      .messages .success {
        background: #e6ffed;
        color: #0a7a33;
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 6px;
        font-size: 14px;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <!-- HEADER -->
      <div class="top-badge">
        <div class="badge">RB</div>
        <div class="brand-title">Resume Builder</div>
      </div>

      <!-- HERO TEXT -->
      <div class="hero">
        <h1>Welcome Back</h1>
        <p>Sign in to continue building your professional resume</p>
      </div>

      <!-- CARD: LOGIN + REGISTER -->
      <!-- Messages (Django messages framework) -->
      <div class="card" id="card">
        {% if messages %}
        <div class="messages">
          {% for message in messages %}
          <div class="{{ message.tags }}">{{ message }}</div>
          {% endfor %}
        </div>
        {% endif %}

        <div class="panel-viewport">
          <div class="panel-track" id="panelTrack">
            <!-- LOGIN PANEL -->
            <div class="panel">
              <form id="loginForm" method="post" action="{% url 'login' %}">
                {% csrf_token %}

                <label>Email Address</label>
                <div class="input-wrap">
                  <i class="bx bxs-envelope icon"></i>
                  <input
                    type="email"
                    id="emailLogin"
                    name="email"
                    placeholder="you@example.com"
                    required
                  />
                </div>

                <label style="margin-top: 10px">Password</label>
                <div class="input-wrap">
                  <i class="bx bxs-lock-alt icon"></i>
                  <input
                    type="password"
                    id="passwordLogin"
                    name="password"
                    placeholder="••••••••"
                    required
                  />
                  <button type="button" class="pwd-toggle" id="togglePwdLogin">
                    <i class="bx bx-hide"></i>
                  </button>
                </div>

                <div class="forgot-row">
                  <div><input type="checkbox" /> Remember me</div>
                  <a href="{% url 'password_reset' %}">Forgot password?</a>
                </div>

                <button type="submit" class="btn" style="margin-top: 12px">
                  Sign In
                </button>

                <div class="divider"><span>Or continue with</span></div>

                <div class="socials">
                  <div class="social"><i class="bx bxl-google"></i> Google</div>
                  <div class="social"><i class="bx bxl-github"></i> GitHub</div>
                </div>
              </form>
            </div>

            <!-- SIGNUP PANEL -->
            <div class="panel">
              <form
                id="registerForm"
                method="post"
                action="{% url 'register' %}"
              >
                {% csrf_token %}{% if not show_otp %}

                <label style="margin-top: 10px">Phone Number</label>
                <div class="input-wrap">
                  <i class="bx bxs-phone icon"></i>
                  <input
                    type="tel"
                    id="phone"
                    name="phone"
                    placeholder="+91 9876543210"
                  />
                </div>

                <label style="margin-top: 10px">Email</label>
                <div class="input-wrap" style="justify-content: space-between">
                  <div
                    style="
                      display: flex;
                      align-items: center;
                      gap: 10px;
                      flex: 1;
                    "
                  >
                    <i class="bx bxs-envelope icon"></i>
                    <input
                      type="email"
                      id="emailReg"
                      name="email"
                      placeholder="you@example.com"
                      required
                    />
                  </div>

                  <button
                    type="button"
                    id="verifyEmailBtn"
                    style="
                      background: none;
                      border: none;
                      color: var(--accent-dark);
                      font-weight: 700;
                      cursor: pointer;
                    "
                  >
                    Verify
                  </button>
                </div>
                <!-- OTP SECTION -->
                <div id="otpSection" style="display: none; margin-top: 10px">
                  <label>Enter OTP</label>
                  <div class="input-wrap">
                    <i class="bx bxs-key icon"></i>
                    <input
                      type="text"
                      id="otpInput"
                      name="otp"
                      maxlength="6"
                      placeholder="6-digit OTP"
                    />
                  </div>

                  <div
                    style="
                      display: flex;
                      justify-content: space-between;
                      font-size: 13px;
                      margin-top: 6px;
                    "
                  >
                    <span id="otpTimer">05:00</span>
                    <button
                      type="button"
                      id="resendOtpBtn"
                      disabled
                      style="
                        background: none;
                        border: none;
                        color: #aaa;
                        cursor: pointer;
                      "
                    >
                      Resend OTP
                    </button>
                  </div>
                </div>

                {% if form.email.errors %}
                <div style="color: #b10000; font-size: 12px; margin-top: 4px">
                  {{ form.email.errors.0 }}
                </div>
                {% endif %}

                <label style="margin-top: 10px">Password</label>
                <div class="input-wrap">
                  <i class="bx bxs-lock-alt icon"></i>
                  <input
                    type="password"
                    id="passwordReg"
                    name="password1"
                    placeholder="Create a strong password"
                    required
                  />
                </div>
                <div
                  id="pwdStrength"
                  style="font-size: 13px; margin-top: 4px"
                ></div>
                {% if form.password1.errors %}
                <div style="color: #b10000; font-size: 12px; margin-top: 4px">
                  {{ form.password1.errors.0 }}
                </div>
                {% endif %}

                <label style="margin-top: 10px">Confirm Password</label>
                <div class="input-wrap">
                  <i class="bx bxs-lock-alt icon"></i>
                  <input
                    type="password"
                    id="passwordRegConfirm"
                    name="password2"
                    placeholder="Confirm password"
                    required
                  />
                </div>
                {% if form.password2.errors %}
                <div style="color: #b10000; font-size: 12px; margin-top: 4px">
                  {{ form.password2.errors.0 }}
                </div>
                {% endif %}

                <div style="margin-top: 14px; display: flex; gap: 10px">
                  <button
                    class="btn"
                    type="submit"
                    id="createAccountBtn"
                    disabled
                  >
                    Create account
                  </button>

                  {% endif %}

                  <button type="button" class="btn ghost" id="backToSignIn">
                    Sign In
                  </button>
                </div>

                <div class="divider">
                  <span>By creating an account you agree to our Terms</span>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- FOOTER -->
        <div class="card-footer">
          Don't have an account?
          <a id="signupLink">Sign up for free</a>
        </div>
      </div>
    </div>

    <!-- JS -->
    <script>
      const card = document.getElementById("card");
      const panelTrack = document.getElementById("panelTrack");
      const signupLink = document.getElementById("signupLink");
      const backToSignIn = document.getElementById("backToSignIn");
      const otpInput = document.getElementById("otpInput");
      const createBtn = document.getElementById("createAccountBtn");

      otpInput.addEventListener("input", () => {
        createBtn.disabled = otpInput.value.length !== 6;
      });

      function showRegister() {
        card.classList.add("registered");
        panelTrack.style.transform = "translateX(-50%)";
      }

      function showLogin() {
        card.classList.remove("registered");
        panelTrack.style.transform = "translateX(0%)";
      }

      signupLink.addEventListener("click", (e) => {
        e.preventDefault();
        showRegister();
      });

      backToSignIn.addEventListener("click", () => showLogin());

      // Password toggle
      const togglePwdLogin = document.getElementById("togglePwdLogin");
      const pwdLogin = document.getElementById("passwordLogin");

      togglePwdLogin.addEventListener("click", () => {
        if (pwdLogin.type === "password") {
          pwdLogin.type = "text";
          togglePwdLogin.innerHTML = '<i class="bx bx-show"></i>';
        } else {
          pwdLogin.type = "password";
          togglePwdLogin.innerHTML = '<i class="bx bx-hide"></i>';
        }
      });
      const pwdInput = document.getElementById("passwordReg");
      const strengthText = document.getElementById("pwdStrength");

      pwdInput.addEventListener("input", () => {
        const val = pwdInput.value;
        let strength = "Weak";
        let color = "red";

        if (val.length >= 8 && /[A-Z]/.test(val) && /\d/.test(val)) {
          strength = "Strong";
          color = "green";
        } else if (val.length >= 6) {
          strength = "Medium";
          color = "orange";
        }

        strengthText.textContent = `Password strength: ${strength}`;
        strengthText.style.color = color;
      });

      let timeLeft = 300;
      let timer;

      const verifyBtn = document.getElementById("verifyEmailBtn");
      const otpSection = document.getElementById("otpSection");
      const otpTimer = document.getElementById("otpTimer");
      const resendBtn = document.getElementById("resendOtpBtn");

      if (verifyBtn) {
        function getCSRFToken() {
          return document.querySelector("[name=csrfmiddlewaretoken]").value;
        }

        verifyBtn.addEventListener("click", () => {
          const email = document.getElementById("emailReg").value;

          if (!email) {
            alert("Please enter email first");
            return;
          }

          fetch("{% url 'register' %}", {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
              "X-CSRFToken": getCSRFToken(),
            },
            body: new URLSearchParams({
              action: "send_otp",
              email: email,
            }),
          })
            .then((res) => res.json())
            .then((data) => {
              if (data.error) {
                alert(data.error);
                return;
              }

              otpSection.style.display = "block";
              document.getElementById("emailReg").readOnly = true;
              verifyBtn.disabled = true;
              verifyBtn.textContent = "OTP Sent";
              startTimer();
            })
            .catch(() => {
              alert("Failed to send OTP");
            });
        });
      }

      function startTimer() {
        clearInterval(timer);
        timeLeft = 300;
        resendBtn.disabled = true;
        resendBtn.style.color = "#aaa";

        timer = setInterval(() => {
          timeLeft--;

          let min = Math.floor(timeLeft / 60);
          let sec = timeLeft % 60;

          otpTimer.textContent = `${min.toString().padStart(2, "0")}:${sec
            .toString()
            .padStart(2, "0")}`;

          if (timeLeft === 240) {
            resendBtn.disabled = false;
            resendBtn.style.color = "var(--accent-dark)";
          }

          if (timeLeft <= 0) {
            clearInterval(timer);
            otpTimer.textContent = "OTP Expired";
          }
        }, 1000);
      }

      resendBtn.addEventListener("click", () => {
        verifyBtn.disabled = false;
        verifyBtn.click();
      });
    </script>
    {% if show_register %}
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        document.getElementById("card").classList.add("registered");
        document.getElementById("panelTrack").style.transform =
          "translateX(-50%)";
      });
    </script>
    {% endif %}
  </body>
</html>
